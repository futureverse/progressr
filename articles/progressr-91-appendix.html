<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>progressr: Appendix • progressr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="progressr: Appendix">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">progressr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.15.1-9021</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/progressr-01-intro.html">progressr: An Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-11-handlers.html">progressr: Customize How Progress is Reported</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-21-map-reduce.html">progressr: Map-Reduce Calls, e.g. lapply() and map()</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-22-parallel-processing.html">progressr: Parallel and Distributed Processing</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-25-replace-cli-with-progressr.html">progressr: Replace 'cli' Progress Bars with 'progressr'</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-29-debug.html">progressr: Debug</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-31-knitr.html">progressr: Render 'knitr' Documents</a></li>
    <li><a class="dropdown-item" href="../articles/progressr-91-appendix.html">progressr: Appendix</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.futureverse.org/"><span class="fa fas fa-home"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-packages">
<li><a class="external-link dropdown-item" href="https://doFuture.futureverse.org">doFuture (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://furrr.futureverse.org">furrr (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.futureverse.org">future</a></li>
    <li><a class="external-link dropdown-item" href="https://future.apply.futureverse.org">future.apply (map-reduce)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.batchtools.futureverse.org">future.batchtools (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.callr.futureverse.org">future.callr (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mirai.futureverse.org">future.mirai (backend)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tests.futureverse.org">future.tests</a></li>
    <li><a class="external-link dropdown-item" href="https://globals.futureverse.org">globals</a></li>
    <li><a class="external-link dropdown-item" href="https://listenv.futureverse.org">listenv</a></li>
    <li><a class="external-link dropdown-item" href="https://parallelly.futureverse.org">parallelly</a></li>
    <li><a class="dropdown-item" href="https://progressr.futureverse.org">progressr</a></li>
    <li><a class="external-link dropdown-item" href="https://BiocParallel.FutureParam.futureverse.org">BiocParallel.FutureParam (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.tools.futureverse.org">future.tools (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://future.mapreduce.futureverse.org">future.mapreduce (experimental)</a></li>
    <li><a class="external-link dropdown-item" href="https://marshal.futureverse.org">marshal (experimental)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://cloud.r-project.org/package=progressr"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/futureverse/progressr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>progressr: Appendix</h1>
                        <h4 data-toc-skip class="author">Henrik
Bengtsson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/futureverse/progressr/blob/HEAD/vignettes/progressr-91-appendix.md" class="external-link"><code>vignettes/progressr-91-appendix.md</code></a></small>
      <div class="d-none name"><code>progressr-91-appendix.Rmd</code></div>
    </div>

    
    
<!--
%\VignetteIndexEntry{progressr: Appendix}
%\VignetteAuthor{Henrik Bengtsson}
%\VignetteKeyword{R}
%\VignetteKeyword{package}
%\VignetteKeyword{vignette}
%\VignetteKeyword{packages}
%\VignetteEngine{progressr::selfonly}
-->
<div class="section level2">
<h2 id="how-tos">How tos<a class="anchor" aria-label="anchor" href="#how-tos"></a>
</h2>
<div class="section level3">
<h3 id="report-on-progress-in-non-interactive-mode-batch-mode">Report on progress in non-interactive mode (“batch mode”)<a class="anchor" aria-label="anchor" href="#report-on-progress-in-non-interactive-mode-batch-mode"></a>
</h3>
<p>When running R from the command line, R runs in a non-interactive
mode (<code><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive()</a></code> returns <code>FALSE</code>). The
default behavior of <strong>progressr</strong> is to <em>not</em> report
on progress in non-interactive mode. To reported on progress also then,
set R options <code>progressr.enable</code> or environment variable
<code>R_PROGRESSR_ENABLE</code> to <code>TRUE</code>. For example,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> Rscript <span class="at">-e</span> <span class="st">"library(progressr)"</span> <span class="at">-e</span> <span class="st">"with_progress(y &lt;- slow_sum(1:10))"</span></span></code></pre></div>
<p>will <em>not</em> report on progress, whereas</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> export R_PROGRESSR_ENABLE=TRUE</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> Rscript <span class="at">-e</span> <span class="st">"library(progressr)"</span> <span class="at">-e</span> <span class="st">"with_progress(y &lt;- slow_sum(1:10))"</span></span></code></pre></div>
<p>will.</p>
</div>
</div>
<div class="section level2">
<h2 id="notes-of-caution">Notes of caution<a class="anchor" aria-label="anchor" href="#notes-of-caution"></a>
</h2>
<div class="section level3">
<h3 id="avoid-sending-progress-updates-too-frequently">Avoid sending progress updates too frequently<a class="anchor" aria-label="anchor" href="#avoid-sending-progress-updates-too-frequently"></a>
</h3>
<p>Signaling progress updates comes with some overhead. In situation
where we use progress updates, this overhead is typically much smaller
than the task we are processing in each step. However, if the task we
iterate over is quick, then the extra time induced by the progress
updates might end up dominating the overall processing time. If that is
the case, a simple solution is to only signal progress updates every
n:th step. Here is a version of <code><a href="../reference/slow_sum.html">slow_sum()</a></code> that signals
progress every 10:th iteration:</p>
<pre><code><span><span class="va">slow_sum</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="../reference/progressor.html">progressor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="va">sum</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">kk</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="va">sum</span> <span class="op">&lt;-</span> <span class="va">sum</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">kk</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">kk</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">10</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span>message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Adding %g"</span>, <span class="va">x</span><span class="op">[</span><span class="va">kk</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">sum</span></span>
<span><span class="op">}</span></span></code></pre>
<p>The overhead of progress signaling may depend on context. For
example, in parallel processing with near-live progress updates via
‘multisession’ futures, each progress update is communicated via a
socket connections back to the main R session. These connections might
become clogged up if progress updates are too frequent.</p>
</div>
</div>
<div class="section level2">
<h2 id="known-limitations">Known Limitations<a class="anchor" aria-label="anchor" href="#known-limitations"></a>
</h2>
<div class="section level3">
<h3 id="the-global-progress-handler-cannot-be-set-during-package-load">The global progress handler cannot be set during package load<a class="anchor" aria-label="anchor" href="#the-global-progress-handler-cannot-be-set-during-package-load"></a>
</h3>
<p>It is <em>not</em> possible to call
<code>handlers(global = TRUE)</code> in all circumstances. For example,
it cannot be called within <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> and
<code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">withCallingHandlers()</a></code>;</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tryCatch</span>(<span class="fu">handlers</span>(<span class="at">global =</span> <span class="cn">TRUE</span>), <span class="at">error =</span> identity)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">globalCallingHandlers</span>(<span class="cn">NULL</span>) <span class="sc">:</span> </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  should not be called with handlers on the stack</span></code></pre></div>
<p>This is not a bug - neither in <strong>progressr</strong> nor in R
itself. It’s due to a conservative design on how <em>global</em> calling
handlers should work in R. If it allowed, there’s a risk we might end up
getting weird and unpredictable behaviors when messages, warnings,
errors, and other types of conditions are signaled.</p>
<p>Because <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> and
<code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">withCallingHandlers()</a></code> is used in many places throughout
base R, this means that we also cannot call
<code>handlers(global = TRUE)</code> as part of a package’s startup
process, e.g. <code>.onLoad()</code> or <code>.onAttach()</code>.</p>
<p>Another example of this error is if
<code>handlers(global = TRUE)</code> is used inside package vignettes
and dynamic documents such as Rmarkdown. In such cases, the global
progress handler has to be enabled <em>prior</em> to processing the
document, e.g.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> progressr<span class="sc">::</span><span class="fu">handlers</span>(<span class="at">global =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="sc">&gt;</span> rmarkdown<span class="sc">::</span><span class="fu">render</span>(<span class="st">"input.Rmd"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-progressor-cannot-be-created-in-the-global-environment">A progressor cannot be created in the global environment<a class="anchor" aria-label="anchor" href="#a-progressor-cannot-be-created-in-the-global-environment"></a>
</h3>
<p>It is not possible to create a progressor in the global environment,
e.g. in the the top-level of a script. It can only be created inside a
function, within <code>with_progress({ ... })</code>,
<code>local({ ... })</code>, or a similar construct. For example, the
following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org">progressr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/progressor.html">progressor</a></span><span class="op">(</span>along <span class="op">=</span> <span class="va">xs</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">xs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"x=%g"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>results in an error if tried:</p>
<pre><code>Error in progressor(along = xs) : 
  A progressor must not be created in the global environment unless wrapped in a
  with_progress() or without_progress() call. Alternatively, create it inside a
  function or in a local() environment to make sure there is a finite life span
  of the progressor</code></pre>
<p>The solution is to wrap it in a <code>local({ ... })</code> call, or
more explicitly, in a <code>with_progress({ ... })</code> call:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org">progressr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="fu"><a href="../reference/with_progress.html">with_progress</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/progressor.html">progressor</a></span><span class="op">(</span>along <span class="op">=</span> <span class="va">xs</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">xs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"x=%g"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#  |====================                               |  40%</span></span></code></pre></div>
<p>The main reason for this is to limit the life span of each
progressor. If we created it in the global environment, there is a
significant risk it would never finish and block all of the following
progressors.</p>
</div>
</div>
<div class="section level2">
<h2 id="known-issues">Known Issues<a class="anchor" aria-label="anchor" href="#known-issues"></a>
</h2>
<div class="section level3">
<h3 id="positron">Positron<a class="anchor" aria-label="anchor" href="#positron"></a>
</h3>
<div class="section level4">
<h4 id="setting-global-progressr-handlers-during-startup-does-not-work">Setting global progressr handlers during startup does not work<a class="anchor" aria-label="anchor" href="#setting-global-progressr-handlers-during-startup-does-not-work"></a>
</h4>
<p>Positron does not support setting global calling handlers during R’s
startup process, e.g. in <code>~/.Rprofile</code>. Even if such handlers
are registered, they have no effect. This is a <a href="https://github.com/posit-dev/positron/issues/9480" class="external-link">bug in
Positron</a>, which was last confirmed with Position 2025.09.0 on Linux.
Because of this, having something like in your
<code>~/.Rprofile</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"progressr"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>will have no effect. If used, the workaround is to manually
re-registering all calling handlers <em>at the R prompt</em>, which can
be done as:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">globalCallingHandlers</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">globalCallingHandlers</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, call:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co">## important</span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="messages-and-warnings-adds-extra-newlines-during-progress-reporting">Messages and warnings adds extra newlines during progress
reporting<a class="anchor" aria-label="anchor" href="#messages-and-warnings-adds-extra-newlines-during-progress-reporting"></a>
</h4>
<p>One of the features of <strong>progressr</strong> is that messages
are buffered during progress reporting and relayed as soon as possible,
which typically happens just before handlers re-render the progress
output. This way you can use <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> as usual, regardless
whether progress is reported or not.</p>
<p>Currently, when using Positron (e.g. Positron 2025.09.0), any
<code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code>:s result in extra newlines being injected before
each message, if progress reporting is active, e.g.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="sc">&gt;</span> progressr<span class="sc">::</span><span class="fu">handlers</span>(<span class="at">global =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="sc">&gt;</span> progressr<span class="sc">::</span><span class="fu">handlers</span>(<span class="st">"cli"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="sc">&gt;</span> y <span class="ot">&lt;-</span> progressr<span class="sc">::</span><span class="fu">slow_sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">message =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>M<span class="sc">:</span> Added value <span class="dv">1</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>M<span class="sc">:</span> Added value <span class="dv">2</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>■■■■■■■                           <span class="dv">20</span>% <span class="sc">|</span> P<span class="sc">:</span> Adding <span class="dv">2</span> ETA<span class="sc">:</span>  <span class="dv">9</span>s</span></code></pre></div>
<p>I do not fully understand the reason for this, but I hope we can get
to the bottom of it and fix it, either in <strong>progressr</strong> or
in Positron.</p>
</div>
</div>
<div class="section level3">
<h3 id="jupyter-notebook-and-jupyter-lab">Jupyter Notebook and Jupyter Lab<a class="anchor" aria-label="anchor" href="#jupyter-notebook-and-jupyter-lab"></a>
</h3>
<div class="section level4">
<h4 id="reporting-progress-to-stderr-does-not-work">Reporting progress to stderr does not work<a class="anchor" aria-label="anchor" href="#reporting-progress-to-stderr-does-not-work"></a>
</h4>
<p>The default for most terminal progress renders, including the ones
for <strong>progressr</strong>, display the progress on standard error
(stderr). Due to limitation in Jupyter, this default does not work
there. The reason is that <a href="https://github.com/futureverse/progressr/issues/170" class="external-link">Jupyter
silently drops</a> any output send to stderr, e.g.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">cat</span>(<span class="st">"hello stderr</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">file =</span> <span class="fu">stderr</span>())</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">cat</span>(<span class="st">"hello stdout</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">file =</span> <span class="fu">stdout</span>())</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>hello stdout</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="sc">&gt;</span></span></code></pre></div>
<p>If we try the following</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org">progressr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>globals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span><span class="st">"txtprogressbar"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slow_sum.html">slow_sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>there will be no progress being reported. This is not specific to
<strong>progressr</strong>, we have the same problem with for instance
<strong>cli</strong>. Try for instance,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">void</span> <span class="op">&lt;-</span> <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_progress_demo.html" class="external-link">cli_progress_demo</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span></code></pre></div>
<p>The workaround is to direct all progress output to the standard
output (stdout) when working in Jupyter. For this to work, we also need
to disable the buffering (“delaying”) of any other output to stdout.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org">progressr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span>globals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Workaround for Jupyter</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>progressr.enable <span class="op">=</span> <span class="cn">TRUE</span>, progressr.delay_stdout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Jupyter requires that progress is rendered to standard output;</span></span>
<span><span class="co">## it does not work with the default standard error</span></span>
<span><span class="fu"><a href="../reference/handlers.html">handlers</a></span><span class="op">(</span><span class="fu"><a href="../reference/handler_txtprogressbar.html">handler_txtprogressbar</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slow_sum.html">slow_sum</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="handlersprogress-output-is-messy">handlers(“progress”) output is messy<a class="anchor" aria-label="anchor" href="#handlersprogress-output-is-messy"></a>
</h4>
<p>Jupyter has other outputting issues. Specifically, Jupyter <a href="https://github.com/IRkernel/IRkernel/issues/732" class="external-link">injects an
<em>extra</em> newline at the end of every message</a>, e.g.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">message</span>(<span class="st">"abc"</span>, <span class="at">appendLF =</span> <span class="cn">FALSE</span>); <span class="fu">message</span>(<span class="st">"def"</span>, <span class="at">appendLF =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>abc</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>def</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">message</span>(<span class="st">"abc"</span>); <span class="fu">message</span>(<span class="st">"def"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>abc</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>def</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="sc">&gt;</span> </span></code></pre></div>
<p>This causes any progress framework (e.g. the
<strong>progress</strong> package) that reports via messages to render
progress output very poorly or not at all.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="design-and-implementation">Design and Implementation<a class="anchor" aria-label="anchor" href="#design-and-implementation"></a>
</h2>
<div class="section level3">
<h3 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h3>
<p>When using the <strong>progressr</strong> package, progression
updates are communicated via R’s condition framework, which provides
methods for creating, signaling, capturing, muffling, and relaying
conditions. Progression updates are of classes <code>progression</code>
and <code>immediateCondition</code>(*). The below figure gives an
example how progression conditions are created, signaled, and
rendered.</p>
<p>(*) The <code>immediateCondition</code> class of conditions are
relayed as soon as possible by the <strong><a href="https://future.futureverse.org" class="external-link">future</a></strong> framework,
which means that progression updates produced in parallel workers are
reported to the end user as soon as the main R session have received
them.</p>
<p><img src="imgs/slow_sum.svg"></p>
<p><em>Figure: Sequence diagram illustrating how signaled progression
conditions are captured by <code><a href="../reference/with_progress.html">with_progress()</a></code>, or the global
progression handler, and relayed to the two progression handlers
‘progress’ (a progress bar in the terminal) and ‘beepr’ (auditory) that
the end user has chosen.</em></p>
</div>
<div class="section level3">
<h3 id="roadmap">Roadmap<a class="anchor" aria-label="anchor" href="#roadmap"></a>
</h3>
<p>Because this project is under active development, the progressr API
is currently kept at a very minimum. This will allow for the framework
and the API to evolve while minimizing the risk for breaking code that
depends on it. The roadmap for developing the API is roughly:</p>
<ul class="task-list">
<li><p><label><input type="checkbox" checked>Provide minimal API
for producing progress updates, i.e. <code><a href="../reference/progressor.html">progressor()</a></code>,
<code><a href="../reference/with_progress.html">with_progress()</a></code>, <code><a href="../reference/handlers.html">handlers()</a></code></label></p></li>
<li><p><label><input type="checkbox" checked>Add support for global
progress handlers removing the need for the user having to specify
<code><a href="../reference/with_progress.html">with_progress()</a></code>, i.e. <code>handlers(global = TRUE)</code>
and <code>handlers(global = FALSE)</code></label></p></li>
<li><p><label><input type="checkbox">Make it possible to create a
progressor also in the global environment (see ‘Known issues’
above)</label></p></li>
<li><p><label><input type="checkbox">Add support for nested progress
updates</label></p></li>
<li><p><label><input type="checkbox">Add API to allow users and
package developers to design additional progression
handlers</label></p></li>
</ul>
<p>For a more up-to-date view on what features might be added, see <a href="https://github.com/futureverse/progressr/issues" class="external-link uri">https://github.com/futureverse/progressr/issues</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

    </footer>
</div>





  </body>
</html>
